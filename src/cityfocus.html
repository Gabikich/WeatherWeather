<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>City Focus</title>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/bulma/0.9.4/css/bulma.min.css" />
  <link rel="stylesheet" href="/assets/styles.css" />
  <script src="/assets/data/weather_data.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/dayjs@1/dayjs.min.js"></script>
  <script src="/assets/js/bulma.js"></script>
</head>

<body>
  <header>
    <nav class="navbar is-primary" role="navigation" aria-label="main navigation">
      <div class="navbar-brand">
        <a class="navbar-item" href="#">
          <img class="logo" src="/assets/images/logo.png" alt="Logo" style="max-height: 5rem;">
        </a>
        <span class="navbar-burger has-background-black" data-target="navbarMenu" aria-expanded="false">
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
          <span aria-hidden="true"></span>
        </span>
      </div>
      <div id="navbarMenu" class="navbar-menu">
        <!-- City Focus centralized -->
        <div class="navbar-start is-flex is-justify-content-center" style="flex: 1;">
          <span class="navbar-item has-text-weight-bold is-size-5 has-background-link-light has-text-link-dark">
            City Focus
          </span>
        </div>
        <!-- Back to Dashboard on the right side -->
        <div class="navbar-end">
          <a class="navbar-item has-text-weight-medium" href="/"> ←Back to Dashboard </a>
        </div>
      </div>
    </nav>
  </header>

  <main class="section">
    <div class="container">
      <h1 class="title has-text-centered" id="cityTitle">Loading...</h1>

      <!-- Card: Today's Weather -->
      <section class="card hasmb-5">
        <header class="card-header">
          <p class="card-header-title is-justify-content-center is-flex-grow-1 has-text-centered">
            Today's Weather
          </p>
        </header>
        <div class="card-content has-text-centered">
          <p id="weatherDesc">Weather: Loading...</p>
          <p id="maxTemp">Max Temp: Loading...</p>
          <p id="maxWind">Max Wind: Loading...</p>
        </div>
      </section>

      <!-- Card: Current Hour -->
      <section class="card mb-5">
        <header class="card-header">
          <p class="card-header-title is-justify-content-center is-flex-grow-1 has-text-centered">
            Current Hour
          </p>
        </header>
        <div class="card-content has-text-centered">
          <p id="currentTime">Loading time...</p>
          <p id="hourTemp">Temperature Now: Loading...</p>
          <p id="hourWind">Wind Now: Loading...</p>
        </div>
      </section>

      <!-- Card: 7-Day Summary -->
      <section class="card">
        <header class="card-header">
          <p class="card-header-title is-justify-content-center is-flex-grow-1 has-text-centered">
            7-Day Summary
          </p>
        </header>
        <div class="card-content">
          <ul id="sevenDaySummary" class="has-text-centered"></ul>
        </div>
      </section>

    </div>
  </main>

  <footer class="footer">
    <div class="content has-text-centered">
      <p><strong>WeatherWeather - CityFocus</strong></p>
    </div>
  </footer>

  <script>
    const weatherDescriptions = {
      0: "Clear sky",
      1: "Mainly clear",
      2: "Partly cloudy",
      3: "Overcast",
      51: "Light drizzle",
      61: "Rain showers",
      80: "Rainy",
      71: "Snow",
    };

    function getCityFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get("city")?.toLowerCase();
    }

    function updateCurrentTime() {
      const now = dayjs();
      const formattedTime = now.format("HH:mm");
      document.getElementById("currentTime").textContent = `Current Time: ${formattedTime}`;
      return now.hour(); // returns the current hours to use in the forecast
    }

    document.addEventListener("DOMContentLoaded", () => {
      const city = getCityFromURL();
      if (!city) {
        alert("No city provided in URL.");
        return;
      }

      document.getElementById("cityTitle").textContent = `City Focus: ${city.charAt(0).toUpperCase() + city.slice(1)}`;

      const daily = weatherData[city + "_daily"].daily;
      const hourly = weatherData[city + "_hourly"].hourly;

      // Data of current day
      const weatherCode = daily.weather_code[0];
      const maxTemp = daily.temperature_2m_max[0];
      const maxWind = daily.wind_speed_10m_max[0];
      document.getElementById("weatherDesc").textContent = `Weather: ${weatherDescriptions[weatherCode] || 'Unknown'}`;
      document.getElementById("maxTemp").textContent = `Max Temperature: ${maxTemp}°C`;
      document.getElementById("maxWind").textContent = `Max Wind Speed: ${maxWind} km/h`;

      // Current Hours
      const hourIndex = updateCurrentTime();
      const tempNow = hourly.temperature_2m[hourIndex];
      const windNow = hourly.wind_speed_10m[hourIndex];
      document.getElementById("hourTemp").textContent = `Temperature Now: ${tempNow}°C`;
      document.getElementById("hourWind").textContent = `Wind Now: ${windNow} km/h`;

      // 7 days
      const list = document.getElementById("sevenDaySummary");
      const now = dayjs();

      for (let i = 0; i < daily.weather_code.length; i++) {
        const item = document.createElement("li");
        const desc = weatherDescriptions[daily.weather_code[i]] || `Code ${daily.weather_code[i]}`;

        const dayName = i === 0
          ? "Today"
          : i === 1
            ? "Tomorrow"
            : now.add(i, 'day').format("dddd"); // ex: Wednesday

        item.textContent = `${dayName}: ${desc}`;
        list.appendChild(item);
      }

    });
  </script>
</body>

</html>